# 智能合约

本质，mqtt client

提供server服务；属于应用角色；
同 apiservergo get github.com/goiiot/libmqtt

mqttV5

2019年5月7日20点04分
v5的改动略大，弃之

2019年5月8日10点42分


postServer done

但是smartServer中的这个事务数据准备，需要好几个查询准备数据，需要根据业务进行；

还许需要解决topic的定义问题，

方案1：
服务提供者/服务名

坑就是，post需要转发一下，所以，smart转发的时候，把自己的clientid加个turn好了；

老方案中的/replay会很丑

# 初始化用户余额
当用后首次使用时，检查本地无密钥对，及新用户时，本用例开始执行；
## 基本流
1. 前端获取用户昵称作为clientId，提交到postServer获取密钥对，保存到本地；
2. smartServer准备数据 admin公私钥，用户公钥，用户余额0；
3. 提交到postServer，等待响应成功后，响应前端。
## 可选流
1. 不能获取用户昵称；不能分配密钥对；不能初始化；提示失败，用例结束；

11点13分 看看吃饭前能不能搞定，保存密钥到本地。

16点14分 保存密钥到本地 done

初始化 用户余额信息。
先查chain，用户余额，若无创建之。
这一步需要查询，按用户昵称查，资产，http get chaindb

后边的业务都是 查，改，增的操作，主要是 查和改的组合。
尽量不定义结构体。

需要几个模块 http 查询，数据组装，没什么了，底层逻辑由db做；

# 用例：查看余额
当用户需要查看自己的余额时，本用力开始执行；
## 基本流
1. 前端获取 用户昵称+公钥
2. 在chain中查询该用户的余额
3. 返回给前端，前端展示
## 可选流
1. 若该用户为新用户，为其初始化余额0；
2. 若在chain中该用户的资产分散了，合并后展示；

